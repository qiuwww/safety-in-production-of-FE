# 前端H5 Code Review

结合别人的经验，选择符合实际需求的 Code Review 形式，设定一些必要的 Code Review 标准。

## 目标与原则

### 1. 提高代码质量，及早发现程序潜在的缺陷

### 2. 规范项目结构，避免冗余代码，方便别人阅读与维护

### 3. 促进团队内部知识共享，相互学习，提高团队整体水平

### 4. 便捷交叉维护

## 方式与规则

Code Review 的过程需要结合代码 PR 的过程，但是每一次的 PR 都进行 Code Review 也很耗费时间，不太现实，所以可以基于一下的方式与原则进行。

### 1. Code Review需要结合代码PR的过程，所以要规范PR

- 1. 每个任务都新建feature进行开发，如feature/ft_v2.9_20200808
- 2. 对于每次 PR 的 commit 有准确的描述

	- 1. 改动了什么
	- 2. 解决了什么问题
	- 3. 需要代码 Review 的人留意哪些影响比较大的改动

- 3. 真正需要review的时候，一般这个时候代码都是发布到了测试环境的，所以要选择一个git的一个节点进行review

### 2. 需要选择合适的时间点进行Code Review

- 1. 对接接口完成之后，代码提测之前
- 2. 代码发布之前，即代码需要合并master的时候

### 3. Code Review，由相近开发任务的同学，加上小组长，三个人进行，由需要Review代码的人讲解自己的代码，需要有必要的记录，具体的记录模板可以参考report-template.md

### 4. Code Review的目标是减少bug，提高代码的可维护性，主要Review如下的方面：

- 1. UI 还原度
- 2. 是否都完成了设计文档的功能需求
- 3. 关键部分的代码逻辑
- 4. 项目结构，代码风格

## Code Review 基础标准

作为一个基础的标准，减少争议，寻找一种大多数人认可标准。

### 1. 需要符合基础设定的ESlint规则，使用prettier+eslint对代码进行基础规范，最基础的plugin:vue/essential+@vue/prettier，具体参考<https://gitlab.91jkys.com/f2e/prettier>

- 1. 2 空格缩进
- 2. 类型的声明，let与const的区分
- 3. debugger与console
- ...

### 2. 命名规则

- 1. 项目与文件夹命名，中划线链接小写字符(kebab-case，短横线法)
- 2. 组件名命名

	- 1. 大写字母开头的形式(PascalCase，单词首字母大写命名)，和DemoComponent/index.vue的形式，都能接受，但同一项目最好只出现一种，避免不统一的问题。
	- 2. 组件名应该以高级别的 (通常是一般化描述的) 单词开头，以描述性的修饰词结尾，如：SearchButtonClear.vue，SearchInputQuery.vue

- 3. 路由命名，path 使用全小写，多个单词用 - 分开，name 与 path 保持一致
- 4. 请求 service 命名，所有定义的接口以 api 开头小驼峰命名，尽量语义化，不要简写，如apiGetHomeList
- 5. 标签 class 属性 命名，class 和 id 的命名应该语义化，全部小写，多个单词用连接线 - 连接，可以不遵循bem规则

### 3. 项目结构

- 1. package.json 文件

	- 1. .browserslist等配置类的文件尽量集成到 package.json 中
	- 2. 添加必要的项目描述description等信息，注意维护 version 与任务开发版本号一致
	- 3. 生产环境依赖与开发环境依赖要区分清楚

- 2. README.md 文件添加必要的项目开发说明，或者语雀添加项目版本迭代说明

	- 1. 开发环境搭建及打包发布方式

		- 1. 配置访问接口 host
		- 2. 需要关注的公众号之类的，微信开发者权限
		- 3. 打包发布方式说明，是ci/cd 还是jenkins

	- 2. 资源说明

		- 1. 接口文档地址
		- 2. PRD及UI

- 3. src 目录

	- 1. assets，用到的图片/字体等资源，尽量存放在当前项目内

		- 1. 对于较大的文件或者追求页面性能的地方可以放在第三方，也要说明具体的资源维护方式，避免丢失引起问题

	- 2. components，存放公共组件
	- 3. constant，项目中用到的常量参数
	- 4. pages，分模块页面存放，单独的业务组件就近存放在模块下的components内
	- 5. router，可以分模块存放路由
	- 6. store，分模块对应页面的store
	- 7. mixins，用于逻辑复用，组合组件，存放位置与component一致，除公用的混入，其他就近存放

		- 1. 注意避免混入生命周期/watch等，这样不便与查找问题
		- 2. 避免全局混入

	- 8. styles，样式文件

		- 1. common.less， 样式重置，预设的公共样式，全局样式，
		- 2. variables.less，less 变量文件

	- 9. utils，纯函数工具库，需要添加描述和示例注释
	- 10. services，存放请求服务，数据请求及三方服务等，请求地址直接在声明方法内使用，不使用常量定义再引用的形式，可以mock复制过来直接使用
	- 11. filters，过滤器，需要声明作用和示例注释
	- 12. directives，自定义指令，比较麻烦的需要有示例注释
	- 13. app.vue，main.ts，webview 可选

- 4. public，存放 index.html 和静态资源文件，jquery，lodash 等不需要编译的资源包
- 5. types，ts 声明文件目录
- 6. 对于模块要使用统一文件导出目录内资源的方式，如components/index.ts，utils/index.ts
- 7. 生产环境发布确认

	- 1. 所有 console 信息需要去掉，敏感注释也要处理掉
	- 2. 测试数据, 假数据, 旧代码, 删掉. (部分可用于下一期开发的业务代码, 请做好 TODO 标记, 避免误删)

### 4. Vue 单文件组件

- 1. template，根标签，最好添加当前组件的名称 class，便于查找，<div class="address-list"></div>
- 2. 属性声明一般遵循如下的顺序

	- 1.  component，mixin
	- 2. data，props
	- 3. computed
	- 4. watch
	- 5. created、mounted、activited、update
	- 6. beforeRouteUpdate
	- 7. methods
	- 8. filter

- 3. template内不应有太多的逻辑操作，组件模板应该只包含简单的表达式，复杂的表达式则应该重构为计算属性或方法
- 4. 组件需要说明如何使用，必传参数等
- 5. 组件最好不超过 400 行
- 6. 注意组件的可复用性 & 组合

	- 1. DRY（Do not Repeat Yourself）原则：同一代码块不应该重复两次及以上
	- 2. 使用mixins组合组件，复用逻辑
	- 3. 注意拆分组件

		- 1. 可依照功能模块进行拆分
		- 2. 业务逻辑独立的模块应该抽离出来
		- 3. 程序的每个功能是否都作为一个可辩识的代码块存在

- 7. pages，按照业务/逻辑相近原则放在一起，对应 store/router/constant/service各个模块

	- 1. 公共 components 放在src/components下，非公共业务组件就近存放原则，./components
	- 2. 比如地址模块的增删改查页面都放在一起，统一存放在 address 目录下，其下分别创建需要的页面，pages/address/AddressList.vue、pages/address/AddAndEditAddress.vue等

- 8. 应该优先通过 Vuex 管理全局状态，而不是通过 this.$root 或一个全局事件总线

### 5. html语义化标签

- 1. 要符合基本的嵌套规则

	- 1. 块元素可以包含内联元素或某些块元素，但内联元素却不能包含块元素，它只能包含其它的内联元素
	- 2. 块级元素不能放在<p>里面
	- 3. 块级元素与块级元素并列、内嵌元素与内嵌元素并列

- 2. 语义化标签，常见如下

	- 1. <Hx>，h1~h6
	- 2. <p>，段落标记
	- 3. <span>组合文档中的行内元素
	- 4. <em>和<strong>，强调，这里需要预先重置样式
	- 5. <section>，区段、<header>、<footer>

### 6. ts/js

- 1. 必要的注释

	- 1. 函数功能的注释，如 utils 下的功能函数，filter 的使用等，给出描述、参数及使用示例
	- 2. 函数｜组件参数的注释，通过参数名和类型可以轻松知道传递的参数规则，props.require
	- 3. 关键｜复杂业务的逻辑注释
	- 4. 对非常规行为和边界情况处理，添加描述/注释

- 2. 必要的设计模式

	- 1. 策略模式
	- 2. 单例模式
	- 3. 装饰器模式，@
	- 4. 组合模式，mixins
	- ...

- 3. 常量 constant，全部大写，主要用到的地方有，一般都存放在 src/constant下

	- 1. router 路径
	- 2. vuex 的模块命名
	- 3. 枚举类型，非 ts 项目，可以使用对象来表示

- 4. 函数的声明与调用

	- 1. 所有的程序调用都使用了正确的参数个数，是否有未定义出错的风险
	- 2. 参数个数的问题，超过两个最好使用json对象形式传递参数
	- 3. 必要的类型变量，给出默认值替代&&判断

- 5. 必要的异常捕获处理

	- 1. 捕获[Vue 实例的错误处理](https://cn.vuejs.org/v2/api/#errorHandler)
	- 2. js 执行过程中的错误处理，注意

		- 1. 是否调用了不存在的对象的属性
		- 2. 非函数直接执行报错
		- 3. 死循环

- 6. 请求地址及协议的确认

	- 1. 注意区分三个环境是用的 http 还是 https，可以统一省略http|https，利用浏览器的相对地址补全功能

- 7. 可优化点

	- 1. 循环和递归，注意判断边缘条件
	- 2. 按钮是否控制了单次点击
	- 3. 清理（释放）资源

		- 1. 闭包的释放
		- 2. 减少全局变量的使用
		- 3. 定时器是否随生命周期消除

### 7. css样式控制

- 1. 避免使用行类样式
- 2. 样式统一加上 scoped, 避免污染，组件需要样式重置的，采用 deep 方式
- 3. styles 下的公共样式及样式设置变量

## 如何迅速完成 Code Review

避免一些意义不大的事情，从而节省时间。

### 1. 不要刻意地去寻找代码 bug，对于隐藏很深的bug，没有必要在Code Review的时候去深入探究

### 2. 不要按照自己的编程风格去评论别人的代码，争议的地方，可以基于3基础的标准进行

### 3. 不要带着抨击和质疑别人能力的心态去进行代码评审

*XMind - Trial Version*